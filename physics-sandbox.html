<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhysicsBox Sandbox</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(to bottom, #0f172a, #1e293b, #0f172a);
            color: #e0e7ff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            font-size: 3rem;
            font-weight: 900;
            background: linear-gradient(to right, #22d3ee, #a855f7, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(168, 85, 247, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: center;
        }

        select, button {
            padding: 10px 20px;
            border-radius: 8px;
            border: 2px solid rgba(168, 85, 247, 0.5);
            background: rgba(30, 41, 59, 0.9);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.4);
        }

        .btn-primary { background: #2563eb; border-color: #2563eb; }
        .btn-warning { background: #ca8a04; border-color: #ca8a04; }
        .btn-danger { background: #dc2626; border-color: #dc2626; }
        .btn-ghost { background: rgba(71, 85, 105, 0.5); }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .control-group {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .control-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .control-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #c084fc;
            font-weight: 700;
        }

        .control-value {
            font-family: 'Courier New', monospace;
            color: #22d3ee;
            font-size: 0.875rem;
            min-width: 3rem;
            text-align: right;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(168, 85, 247, 0.2);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #a855f7;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(168, 85, 247, 0.5);
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #a855f7;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px rgba(168, 85, 247, 0.5);
        }

        input[type="color"] {
            width: 100%;
            height: 40px;
            border-radius: 8px;
            border: 2px solid rgba(168, 85, 247, 0.5);
            cursor: pointer;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .tool-section h3 {
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 12px;
            color: #c084fc;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .tool-btn {
            padding: 8px 12px;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .tool-btn.active {
            background: linear-gradient(to right, #16a34a, #15803d);
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.5);
            transform: scale(1.05);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            text-align: center;
        }

        .stat-item {
            transition: transform 0.2s;
        }

        .stat-item:hover {
            transform: scale(1.1);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(to right, #ef4444, #dc2626);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-value.blue { background: linear-gradient(to right, #3b82f6, #2563eb); -webkit-background-clip: text; background-clip: text; }
        .stat-value.green { background: linear-gradient(to right, #22c55e, #16a34a); -webkit-background-clip: text; background-clip: text; }
        .stat-value.purple { background: linear-gradient(to right, #a855f7, #9333ea); -webkit-background-clip: text; background-clip: text; }

        .stat-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #94a3b8;
            margin-top: 4px;
        }

        .canvas-container {
            position: relative;
            max-width: 1200px;
            margin: 0 auto;
            aspect-ratio: 10 / 7;
        }

        #physics-canvas {
            position: absolute;
            inset: 0;
            border: 2px solid rgba(168, 85, 247, 0.4);
            border-radius: 12px;
            cursor: crosshair;
            background: rgba(0, 0, 0, 0.2);
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>⚡ PhysicsBox Sandbox ⚡</h1>

        <!-- Toolbar -->
        <div class="card">
            <div class="toolbar">
                <select id="mode-select">
                    <option value="balls">Bouncing Balls</option>
                    <option value="sand">Falling Sand</option>
                    <option value="water">Water Drops</option>
                    <option value="plasma">Plasma Energy</option>
                    <option value="metal">Metal Chunks</option>
                </select>
                <button class="btn-primary" onclick="addParticle()">Add Particle</button>
                <button class="btn-warning" onclick="stressTest()">Stress Test (500)</button>
                <button class="btn-danger" onclick="megaTest()">MEGA (2000)</button>
                <button class="btn-ghost" onclick="clearWorld()">Clear All</button>
            </div>
        </div>

        <!-- Physics Controls -->
        <div class="controls-grid">
            <div class="control-group">
                <div class="control-header">
                    <span class="control-label">Gravity</span>
                    <span class="control-value" id="gravity-value">1.0</span>
                </div>
                <input type="range" id="gravity" min="-2" max="3" step="0.1" value="1" oninput="updateGravity(this.value)">
            </div>
            <div class="control-group">
                <div class="control-header">
                    <span class="control-label">Size</span>
                    <span class="control-value" id="size-value">5</span>
                </div>
                <input type="range" id="size" min="1" max="30" value="5" oninput="updateSize(this.value)">
            </div>
            <div class="control-group">
                <div class="control-header">
                    <span class="control-label">Wind</span>
                    <span class="control-value" id="wind-value">0</span>
                </div>
                <input type="range" id="wind" min="-50" max="50" value="0" oninput="updateWind(this.value)">
            </div>
            <div class="control-group">
                <div class="control-header">
                    <span class="control-label">Time Scale</span>
                    <span class="control-value" id="time-value">1.0</span>
                </div>
                <input type="range" id="time" min="0.1" max="3" step="0.1" value="1" oninput="updateTime(this.value)">
            </div>
        </div>

        <!-- Color Control -->
        <div class="controls-grid">
            <div class="control-group">
                <div class="control-header">
                    <span class="control-label">Particle Color</span>
                </div>
                <input type="color" id="color" value="#ff0000">
            </div>
        </div>

        <!-- Tools & Colliders -->
        <div class="tools-grid">
            <div class="card tool-section">
                <h3>🛠️ Tools</h3>
                <div class="button-grid">
                    <button class="tool-btn active" onclick="setTool('none', this)">Normal</button>
                    <button class="tool-btn" onclick="setTool('spray', this)">Spray</button>
                    <button class="tool-btn" onclick="setTool('gun', this)">Gun</button>
                    <button class="tool-btn" onclick="setTool('explosion', this)">Explode</button>
                </div>
            </div>
            <div class="card tool-section">
                <h3>⚙️ Colliders</h3>
                <div class="button-grid">
                    <button class="tool-btn active" onclick="setCollider('none', this)">None</button>
                    <button class="tool-btn" onclick="setCollider('platform', this)">Platform</button>
                    <button class="tool-btn" onclick="setCollider('bouncer', this)">Bouncer</button>
                    <button class="tool-btn" onclick="setCollider('destroyer', this)">Destroyer</button>
                </div>
            </div>
        </div>

        <!-- Stats -->
        <div class="card">
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="fps">60</div>
                    <div class="stat-label">FPS</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value blue" id="particles">0</div>
                    <div class="stat-label">Particles</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value green" id="highscore">0</div>
                    <div class="stat-label">High Score</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value purple" id="colliders">0</div>
                    <div class="stat-label">Colliders</div>
                </div>
            </div>
        </div>

        <!-- Canvas -->
        <div class="card">
            <div class="canvas-container">
                <div id="physics-canvas"></div>
            </div>
        </div>
    </div>

    <script>
        // Physics engine setup
        const Engine = Matter.Engine;
        const Render = Matter.Render;
        const Runner = Matter.Runner;
        const Bodies = Matter.Bodies;
        const World = Matter.World;
        const Body = Matter.Body;
        const Mouse = Matter.Mouse;
        const MouseConstraint = Matter.MouseConstraint;

        let engine, render, runner, particles = [], colliders = [];
        let currentMode = 'balls', currentTool = 'none', currentCollider = 'none';
        let particleSize = 5, gravity = 1, windForce = 0, timeScale = 1;
        let particleColor = '#ff0000';
        let isMouseDown = false;
        let fps = 60, frameCount = 0, lastTime = performance.now();
        let highScore = 0;

        function init() {
            const container = document.getElementById('physics-canvas');
            const width = container.clientWidth;
            const height = container.clientHeight;

            engine = Engine.create();
            engine.world.gravity.y = gravity;
            engine.timing.timeScale = timeScale;

            render = Render.create({
                element: container,
                engine: engine,
                options: {
                    width: width,
                    height: height,
                    wireframes: false,
                    background: 'transparent',
                    pixelRatio: window.devicePixelRatio || 1
                }
            });

            // Walls
            const thickness = 30;
            const ground = Bodies.rectangle(width / 2, height + thickness / 2, width, thickness, {
                isStatic: true,
                render: { fillStyle: '#2a2a2a' }
            });
            const leftWall = Bodies.rectangle(-thickness / 2, height / 2, thickness, height, {
                isStatic: true,
                render: { fillStyle: '#2a2a2a' }
            });
            const rightWall = Bodies.rectangle(width + thickness / 2, height / 2, thickness, height, {
                isStatic: true,
                render: { fillStyle: '#2a2a2a' }
            });
            const ceiling = Bodies.rectangle(width / 2, -thickness / 2, width, thickness, {
                isStatic: true,
                render: { fillStyle: '#2a2a2a' }
            });
            World.add(engine.world, [ground, leftWall, rightWall, ceiling]);

            // Mouse control
            const mouse = Mouse.create(render.canvas);
            const mouseConstraint = MouseConstraint.create(engine, {
                mouse: mouse,
                constraint: { stiffness: 0.2, render: { visible: false } }
            });
            World.add(engine.world, mouseConstraint);

            // Mouse events
            render.canvas.addEventListener('mousedown', handleMouseDown);
            render.canvas.addEventListener('mousemove', handleMouseMove);
            render.canvas.addEventListener('mouseup', () => isMouseDown = false);
            render.canvas.addEventListener('mouseleave', () => isMouseDown = false);

            runner = Runner.create();
            Runner.run(runner, engine);
            Render.run(render);

            // FPS loop
            requestAnimationFrame(updateLoop);
        }

        function updateLoop() {
            const now = performance.now();
            frameCount++;

            // Wind
            if (windForce !== 0) {
                particles.forEach(p => {
                    Body.applyForce(p, p.position, { x: windForce * 0.001, y: 0 });
                });
            }

            // FPS calculation
            if (now - lastTime >= 1000) {
                fps = Math.round((frameCount * 1000) / (now - lastTime));
                document.getElementById('fps').textContent = fps;
                frameCount = 0;
                lastTime = now;

                if (particles.length > highScore) {
                    highScore = particles.length;
                    document.getElementById('highscore').textContent = highScore;
                }
            }

            document.getElementById('particles').textContent = particles.length;
            document.getElementById('colliders').textContent = colliders.length;

            requestAnimationFrame(updateLoop);
        }

        function createParticle(x, y) {
            if (particles.length >= 50000) return;

            let body;
            const baseProps = { render: { fillStyle: particleColor }, frictionAir: 0.01 };

            switch (currentMode) {
                case 'balls':
                    body = Bodies.circle(x, y, particleSize, { ...baseProps, restitution: 0.8, density: 0.001 });
                    break;
                case 'sand':
                    body = Bodies.rectangle(x, y, particleSize * 1.5, particleSize * 1.5, {
                        ...baseProps, friction: 0.9, density: 0.002, restitution: 0.1
                    });
                    break;
                case 'water':
                    body = Bodies.circle(x, y, particleSize * 0.8, {
                        ...baseProps, friction: 0.1, restitution: 0.1, density: 0.0008, frictionAir: 0.02
                    });
                    break;
                case 'plasma':
                    body = Bodies.circle(x, y, particleSize, {
                        ...baseProps, restitution: 1.2, density: 0.0005, frictionAir: 0.005,
                        render: { fillStyle: `hsl(${Math.random() * 60 + 300}, 100%, 70%)` }
                    });
                    break;
                case 'metal':
                    body = Bodies.rectangle(x, y, particleSize * 2, particleSize * 2, {
                        ...baseProps, density: 0.005, friction: 0.8, restitution: 0.3,
                        render: { fillStyle: '#C0C0C0' }
                    });
                    break;
            }

            if (body) {
                World.add(engine.world, body);
                particles.push(body);
            }
        }

        function createCollider(x, y) {
            let collider;
            switch (currentCollider) {
                case 'platform':
                    collider = Bodies.rectangle(x, y, 120, 20, {
                        isStatic: true, render: { fillStyle: '#8B4513' }
                    });
                    break;
                case 'bouncer':
                    collider = Bodies.circle(x, y, 30, {
                        isStatic: true, restitution: 1.8, render: { fillStyle: '#FF1493' }
                    });
                    break;
                case 'destroyer':
                    collider = Bodies.rectangle(x, y, 60, 60, {
                        isStatic: true, isSensor: true, render: { fillStyle: '#FF0000' }
                    });
                    break;
            }

            if (collider) {
                World.add(engine.world, collider);
                colliders.push(collider);
            }
        }

        function handleMouseDown(e) {
            isMouseDown = true;
            const rect = render.canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            if (currentTool === 'explosion') {
                explode(x, y);
            } else if (currentTool === 'gun') {
                fireGun(x, y);
            } else if (currentCollider !== 'none') {
                createCollider(x, y);
            } else {
                createParticle(x, y);
            }
        }

        function handleMouseMove(e) {
            if (!isMouseDown) return;
            const rect = render.canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            if (currentTool === 'spray' || (currentTool === 'none' && currentCollider === 'none')) {
                createParticle(x, y);
            } else if (currentTool === 'gun') {
                fireGun(x, y);
            }
        }

        function fireGun(x, y) {
            createParticle(x, y);
            const p = particles[particles.length - 1];
            if (p) {
                const angle = Math.random() * Math.PI * 2;
                Body.applyForce(p, p.position, {
                    x: Math.cos(angle) * 0.02,
                    y: Math.sin(angle) * 0.02
                });
            }
        }

        function explode(x, y) {
            const power = 50;
            particles.forEach(p => {
                const dx = p.position.x - x;
                const dy = p.position.y - y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                if (dist < power * 2) {
                    const force = (power * 0.001) / (dist + 1);
                    Body.applyForce(p, p.position, {
                        x: (dx / dist) * force,
                        y: (dy / dist) * force
                    });
                }
            });
        }

        function addParticle() {
            const width = render.canvas.width;
            createParticle(width / 2, 100);
        }

        function stressTest() {
            const width = render.canvas.width;
            for (let i = 0; i < 500; i++) {
                const x = width / 2 + (Math.random() - 0.5) * 200;
                const y = 100 + (Math.random() - 0.5) * 200;
                createParticle(x, y);
            }
        }

        function megaTest() {
            const width = render.canvas.width;
            for (let i = 0; i < 2000; i++) {
                const x = width / 2 + (Math.random() - 0.5) * 300;
                const y = 100 + (Math.random() - 0.5) * 300;
                createParticle(x, y);
            }
        }

        function clearWorld() {
            particles.forEach(p => World.remove(engine.world, p));
            colliders.forEach(c => World.remove(engine.world, c));
            particles = [];
            colliders = [];
        }

        function updateGravity(value) {
            gravity = parseFloat(value);
            engine.world.gravity.y = gravity;
            document.getElementById('gravity-value').textContent = gravity.toFixed(1);
        }

        function updateSize(value) {
            particleSize = parseInt(value);
            document.getElementById('size-value').textContent = particleSize;
        }

        function updateWind(value) {
            windForce = parseInt(value);
            document.getElementById('wind-value').textContent = windForce;
        }

        function updateTime(value) {
            timeScale = parseFloat(value);
            engine.timing.timeScale = timeScale;
            document.getElementById('time-value').textContent = timeScale.toFixed(1);
        }

        function setTool(tool, btn) {
            currentTool = tool;
            document.querySelectorAll('.tool-section:first-child .tool-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function setCollider(collider, btn) {
            currentCollider = collider;
            document.querySelectorAll('.tool-section:last-child .tool-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        document.getElementById('mode-select').addEventListener('change', (e) => {
            currentMode = e.target.value;
        });

        document.getElementById('color').addEventListener('change', (e) => {
            particleColor = e.target.value;
        });

        // Initialize on load
        window.addEventListener('load', init);
    </script>
</body>
</html>
